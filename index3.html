<html>

<head>
    <title>Görsel Üzerine Polygon ve Koordinat Alma</title>
</head>

<body>
    <h1>Görsele Tıklayın (Polygon Üzerinde)</h1>

    <!-- Görseli yüklemek için input -->
    <input type="file" id="fileInput" accept="image/*">

    <!-- Görselin ekranda gösterileceği alan -->
    <div id="imageContainer" style="position: relative;">
        <img id="uploadedImage" style="max-width: 100%; max-height: 400px;">
        <svg id="svgPolygon" style="position: absolute; top: 0; left: 0; pointer-events: none;"></svg>
    </div>

    <script>
        // Dosya yükleme input'u ve görsel öğesini seç
        const fileInput = document.getElementById('fileInput');
        const uploadedImage = document.getElementById('uploadedImage');
        const svgPolygon = document.getElementById('svgPolygon');

        // Polygon yapısını oluşturacak fonksiyon
        function Polygon() {
            var pointList = [];

            this.node = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');

            function build(arg) {
                var res = [];
                for (var i = 0, l = arg.length; i < l; i++) {
                    res.push(arg[i].join(','));
                }
                return res.join(' ');
            }

            this.attribute = function (key, val) {
                if (val === undefined) return this.node.getAttribute(key);
                this.node.setAttribute(key, val);
            };

            this.points = function () {
                for (var i = 0, l = arguments.length; i < l; i += 2) {
                    pointList.push([arguments[i], arguments[i + 1]]);
                }
                this.attribute('points', build(pointList));
            };

            this.points.apply(this, arguments);
        }

        // Dosya yüklendiğinde tetiklenecek olay
        fileInput.addEventListener('change', function (event) {
            const file = event.target.files[0]; // İlk dosyayı al

            // Eğer dosya seçildiyse
            if (file) {
                const reader = new FileReader();

                // Dosya okunduğunda, görseli ekranda göster
                reader.onload = function (e) {
                    uploadedImage.src = e.target.result; // Görselin kaynağını değiştir
                };

                // Dosyayı oku (görseli Data URL formatında)
                reader.readAsDataURL(file);
            }
        });

        // Görsele tıklama olayını dinleyelim
        uploadedImage.addEventListener('click', function (event) {
            const rect = uploadedImage.getBoundingClientRect(); // Görselin sayfadaki konumunu al
            const x = event.clientX - rect.left; // Tıklanan X koordinatını hesapla
            const y = event.clientY - rect.top;  // Tıklanan Y koordinatını hesapla

            console.log("Tıklanan X: " + x + ", Y: " + y);

            // Polygon'un içindeyse, bir şey yap
            if (isPointInPolygon(x, y, polygon)) {
                console.log("Polygon içine tıklanmış!");
            }
        });

        // Polygon içinde bir nokta olup olmadığını kontrol etme
        function isPointInPolygon(x, y, polygon) {
            var poly = polygon.node;
            var points = poly.points;
            var inside = false;
            var length = points.length;

            var xinters;
            var p1x, p1y, p2x, p2y;
            var i, j = length - 1;

            for (i = 0; i < length; i++) {
                p1x = points[i][0];
                p1y = points[i][1];
                p2x = points[j][0];
                p2y = points[j][1];
                if (y > Math.min(p1y, p2y)) {
                    if (y <= Math.max(p1y, p2y)) {
                        if (x <= Math.max(p1x, p2x)) {
                            if (p1y != p2y) {
                                xinters = (y - p1y) * (p2x - p1x) / (p2y - p1y) + p1x;
                            }
                            if (p1x == p2x || x <= xinters) {
                                inside = !inside;
                            }
                        }
                    }
                }
                j = i;
            }

            return inside;
        }

        // Polygon oluştur ve SVG'ye ekle
        var polygon = new Polygon(50, 50, 150, 50, 150, 150, 50, 150);
        polygon.attribute('style', 'fill:rgba(0, 255, 0, 0.5); stroke:green; stroke-width:2');
        svgPolygon.appendChild(polygon.node);
    </script>
</body>

</html>